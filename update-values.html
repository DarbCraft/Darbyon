<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Values</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }
        nav {
            margin-bottom: 20px;
        }
        nav a {
            margin: 10px;
            text-decoration: none;
            color: #000;
        }
        input, button, textarea {
            margin: 10px 0;
        }
        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #555;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
            background-color: #555;
            color: #fff;
        }
        th {
            background-color: #555;
        }
        .update-form {
            display: flex;
            justify-content: space-around;
        }
        .update-btn {
            margin: 0 2px;
            padding: 5px;
            cursor: pointer;
        }
        #messageDisplay {
            margin: 20px 0;
        }
        .half-width-table {
            width: 50%;
            margin: 0 auto;
        }
        .change-log-container {
            width: 40%;
            height: calc(100vh - 40px); /* Adjust the height to fit within the viewport */
            overflow-y: auto; /* Enable vertical scrolling if needed */
            margin-left: 20px;
        }
        .change-log-table {
            width: 100%;
            height: 100%;
            border-collapse: collapse;
            background-color: #555;
        }
    </style>
</head>
<body>
    <div>
        <h1>Update Values</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="settings.html">Settings</a>
            <a href="scoreboard.html">Scoreboard</a>
        </nav>

        <h2>Select Players</h2>
        <table id="playerTable">
            <thead>
                <tr>
                    <th>Update</th>
                    <th>Name</th>
                    <th>Level</th>
                    <th>XP</th>
                    <th>AP</th>
                    <th>HP</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h2>Generate Daily News</h2>
        <div class="half-width-table">
            <table id="dailyNewsTable">
                <tbody>
                    <tr>
                        <td>
                            <button type="button" id="generateMessageButton">Show Daily News</button>
                            <p id="currentMessage">Generate Daily News</p>
                            <p>Messages shown: <span id="messageCounter">0</span></p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="change-log-container">
        <h2>Change Log</h2>
        <table id="changeLogTable" class="change-log-table">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Player</th>
                    <th>Change Type</th>
                    <th>Old Value</th>
                    <th>New Value</th>
                </tr>
            </thead>
            <tbody id="changeList"></tbody>
        </table>
    </div>

    <script>
        // Function to record changes
        function recordChange(playerName, changeType, oldValue, newValue) {
            const change = {
                playerName: playerName,
                changeType: changeType,
                oldValue: oldValue,
                newValue: newValue,
                timestamp: new Date().toLocaleString()
            };

            let changes = JSON.parse(localStorage.getItem('playerChanges')) || [];
            changes.push(change);
            localStorage.setItem('playerChanges', JSON.stringify(changes));

            // Add change to the table on the page
            displayChanges();
        }

        // Function to update a character's XP, AP, or HP
        function updateCharacter(name, type) {
            const value = parseInt(prompt(`Enter ${type.toUpperCase()} value (positive/negative):`), 10) || 0;
            let characters = JSON.parse(localStorage.getItem('characters')) || [];
            
            // Update the character's value
            characters = characters.map(char => {
                if (char.name === name) {
                    const oldValue = char[type];
                    char[type] += value;
                    // Record the change
                    recordChange(name, type, oldValue, char[type]);
                }
                return char;
            });

            // Save the updated characters back to local storage
            localStorage.setItem('characters', JSON.stringify(characters));
            
            // Reload the table to reflect changes
            populatePlayerTable();
        }

        // Function to determine the level based on XP
        function getLevel(xp) {
            if (xp < 5000) {
                return 1;
            } else if (xp < 10000) {
                return 2;
            } else if (xp < 15000) {
                return 3;
            } else if (xp < 20000) {
                return 4;
            } else if (xp < 25000) {
                return 5;
            } else if (xp < 30000) {
                return 6;
            } else {
                return 7; 
            }
        }

        // Function to populate the player table
        function populatePlayerTable() {
            const tbody = document.querySelector('#playerTable tbody');
            tbody.innerHTML = ''; // Clear the table body

            const players = JSON.parse(localStorage.getItem('characters')) || [];
            players.forEach(player => {
                const row = document.createElement('tr');
                const updateCell = document.createElement('td');
                const form = document.createElement('form');
                form.className = 'update-form';
                form.innerHTML = `
                    <button type="button" class="update-btn" onclick="updateCharacter('${player.name}', 'xp')">üèÖ XP</button>
                    <button type="button" class="update-btn" onclick="updateCharacter('${player.name}', 'ap')">üíé AP</button>
                    <button type="button" class="update-btn" onclick="updateCharacter('${player.name}', 'hp')">‚ù§Ô∏è HP</button>
                `;
                updateCell.appendChild(form);
                row.appendChild(updateCell);

                const nameCell = document.createElement('td');
                nameCell.textContent = player.name;
                row.appendChild(nameCell);

                const levelCell = document.createElement('td');
                levelCell.textContent = getLevel(player.xp);
                row.appendChild(levelCell);

                const xpCell = document.createElement('td');
                xpCell.textContent = player.xp;
                row.appendChild(xpCell);

                const apCell = document.createElement('td');
                apCell.textContent = player.ap;
                row.appendChild(apCell);

                const hpCell = document.createElement('td');
                hpCell.textContent = player.hp;
                row.appendChild(hpCell);

                tbody.appendChild(row);
            });
        }

        // Function to display changes in the table
        function displayChanges() {
            const changes = JSON.parse(localStorage.getItem('playerChanges')) || [];
            const changeList = document.getElementById('changeList');
            changeList.innerHTML = ''; // Clear the existing entries

            changes.forEach(change => {
                const row = document.createElement('tr');
                Object.values(change).forEach(value => {
                    const cell = document.createElement('td');
                    cell.textContent = value;
                    row.appendChild(cell);
                });
                changeList.appendChild(row);
            });
        }

        function setBackgroundBasedOnTime() {
            const hour = new Date().getHours();
            let backgroundUrl = '';

            if (hour >= 6 && hour < 9) {
                backgroundUrl = 'https://github.com/DarbCraft/Darbyon/blob/main/Images/Dawn%201.jpeg?raw=true';
            } else if (hour >= 9 && hour < 10) {
                backgroundUrl = 'https://github.com/DarbCraft/Darbyon/blob/main/Images/Dawn%202.jpeg?raw=true'; 
            } else if (hour >= 10 && hour < 14) {
                backgroundUrl = 'https://github.com/DarbCraft/Darbyon/blob/main/Images/Day%201.jpeg?raw=true';
            } else {
                backgroundUrl = 'https://github.com/DarbCraft/Darbyon/blob/main/Images/Day%203.jpeg?raw=true'; 
            }

            document.body.style.backgroundImage = `url('${backgroundUrl}')`;
            document.body.style.backgroundSize = 'cover';        // Ensure the background covers the entire page
            document.body.style.backgroundPosition = 'center';   // Center the background image
            document.body.style.backgroundRepeat = 'no-repeat';  // Prevent the image from repeating
        }

        // Function to load players and populate the table
        function loadPlayers() {
            populatePlayerTable();
            displayChanges(); // Display changes when loading players
        }

        // Generate Daily News Button Functionality
        const dailyMessages = [
            "Don't forget to check the new updates!",
            "Remember to complete your daily quests!",
            "Have you reviewed your character stats today?",
            "Stay tuned for more exciting features!",
            "Keep up the great work and earn more XP!"
        ];
        let messageIndex = 0;

        function showRandomMessage() {
            if (dailyMessages.length === 0) return;
            const message = dailyMessages[messageIndex];
            document.getElementById('currentMessage').textContent = message;

            // Update the counter
            messageIndex = (messageIndex + 1) % dailyMessages.length;
            document.getElementById('messageCounter').textContent = messageIndex + 1;
        }

        document.getElementById('generateMessageButton').addEventListener('click', showRandomMessage);

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setBackgroundBasedOnTime();
            loadPlayers();
        });
    </script>
</body>
</html>
